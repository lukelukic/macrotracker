žA
SD:\macrotracker\MacroTracker\MacroTracker.DietaryData\Controllers\DataController.cs
	namespace 	
MacroTracker
 
. 
DietaryData "
." #
Controllers# .
{ 
[ 
ApiController 
] 
public 

class 
DataController 
:  !
ControllerBase" 0
{ 
private 
readonly  
IFoodEntryRepository -
_repo. 3
;3 4
public 
DataController 
(  
IFoodEntryRepository 2
repo3 7
)7 8
=>9 ;
_repo< A
=B C
repoD H
;H I
[ 	
Route	 
( 
$str 
) 
] 
[ 	
HttpGet	 
] 
public 
ActionResult 
< 
IEnumerable '
<' (
	FoodEntry( 1
>1 2
>2 3
Get4 7
(7 8
[8 9
	FromQuery9 B
]B C
DietaryDataQueryD T
queryU Z
)Z [
{ 	
var 
items 
= 
_repo 
. 
Get !
(! "
f" #
=>$ &
f' (
.( )
	AddedDate) 2
>3 4
query5 :
.: ;
	StartDate; D
&&E G
fH I
.I J
	AddedDateJ S
<T U
queryV [
.[ \
EndDate\ c
&&d f
fg h
.h i
UserIdi o
==p r
querys x
.x y
UserIdy 
)	 €
;
€ 
return 
Ok 
( 
items 
) 
; 
} 	
[ 	
HttpPost	 
( 
$str (
)( )
]) *
public 
void 
Post 
( 
string 
userId  &
,& '
[( )
FromBody) 1
]1 2
MacronutrientModel3 E
modelF K
)K L
{ 	
var   
entry   
=   
new   
	FoodEntry   %
{!! 
Protein"" 
="" 
model"" 
.""  
Protein""  '
,""' (
Fat## 
=## 
model## 
.## 
Fat## 
,##  
Carbohydrate$$ 
=$$ 
model$$ $
.$$$ %
Carbohydrate$$% 1
,$$1 2
KCal%% 
=%% 
model%% 
.%% 
	TotalKcal%% &
,%%& '
	AddedDate&& 
=&& 
DateTime&& $
.&&$ %
Now&&% (
,&&( )
UserId'' 
='' 
userId'' 
}(( 
;(( 
_repo)) 
.)) 
Insert)) 
()) 
entry)) 
))) 
;))  
}** 	
[,, 	

HttpDelete,,	 
(,, 
$str,, 4
),,4 5
],,5 6
public-- 
IActionResult-- 
Delete-- #
(--# $
string--$ *
userId--+ 1
,--1 2
string--3 9
entryId--: A
)--A B
{.. 	
if// 
(// 
!// 
_repo// 
.// 
Get// 
(// 
e// 
=>// 
e//  !
.//! "
UserId//" (
==//) +
userId//, 2
&&//3 5
e//6 7
.//7 8
Id//8 :
==//; =
ObjectId//> F
.//F G
Parse//G L
(//L M
entryId//M T
)//T U
)//U V
.//V W
Any//W Z
(//Z [
)//[ \
)//\ ]
return00 
NotFound00 
(00  
$"00  "U
IEntry with provided id doesn't exist or doesn't belong to specified user.00" k
"00k l
)00l m
;00m n
_repo22 
.22 
Delete22 
(22 
entryId22  
)22  !
;22! "
return33 
	NoContent33 
(33 
)33 
;33 
}44 	
[66 	
HttpPost66	 
(66 
$str66 3
)663 4
]664 5
public77 
IActionResult77  
AddEntryFromCalories77 1
(771 2
string772 8
userId779 ?
,77? @
double77A G
calories77H P
)77P Q
{88 	
try99 
{:: 
var;; 
food;; 
=;; 
new;; 
Food;; #
(;;# $
calories;;$ ,
);;, -
;;;- .
_repo<< 
.<< 
Insert<< 
(<< 
new<<  
	FoodEntry<<! *
{== 
KCal>> 
=>> 
food>> 
.>>  
Kcal>>  $
,>>$ %
	AddedDate?? 
=?? 
DateTime??  (
.??( )
Now??) ,
,??, -
UserId@@ 
=@@ 
userId@@ #
}AA 
)AA 
;AA 
returnBB 
OkBB 
(BB 
)BB 
;BB 
}CC 
catchDD 
(DD '
ArgumentOutOfRangeExceptionDD .
eDD/ 0
)DD0 1
{EE 
returnFF 

BadRequestFF !
(FF! "
eFF" #
.FF# $
MessageFF$ +
)FF+ ,
;FF, -
}GG 
}HH 	
[JJ 	
HttpGetJJ	 
(JJ 
$strJJ 1
)JJ1 2
]JJ2 3
publicKK 
IActionResultKK 
GetKK  
(KK  !
stringKK! '
userIdKK( .
,KK. /
stringKK0 6
entryIdKK7 >
)KK> ?
{LL 	
varMM 
itemMM 
=MM 
_repoMM 
.MM 
FindMM !
(MM! "
userIdMM" (
,MM( )
entryIdMM* 1
)MM1 2
;MM2 3
returnNN 
itemNN 
==NN 
nullNN 
?NN  !
NotFoundNN" *
(NN* +
)NN+ ,
:NN- .
(NN/ 0
IActionResultNN0 =
)NN= >
OkNN> @
(NN@ A
itemNNA E
)NNE F
;NNF G
}OO 	
[QQ 	
HttpPutQQ	 
(QQ 
$strQQ 1
)QQ1 2
]QQ2 3
publicRR 
IActionResultRR 
PutRR  
(RR  !
stringRR! '
userIdRR( .
,RR. /
stringRR0 6
entryIdRR7 >
,RR> ?
[RR@ A
FromBodyRRA I
]RRI J
MacronutrientModelRRJ \
modelRR] b
)RRb c
{SS 	
ifTT 
(TT 
_repoTT 
.TT 
FindTT 
(TT 
userIdTT !
,TT! "
entryIdTT# *
)TT* +
==TT, .
nullTT/ 3
)TT3 4
returnUU 
NotFoundUU 
(UU  
$"UU  "U
IEntry with provided id doesn't exist or doesn't belong to specified user.UU" k
"UUk l
)UUl m
;UUm n
varWW 
entryWW 
=WW 
newWW 
	FoodEntryWW %
{XX 
IdYY 
=YY 
ObjectIdYY 
.YY 
ParseYY #
(YY# $
entryIdYY$ +
)YY+ ,
,YY, -
FatZZ 
=ZZ 
modelZZ 
.ZZ 
FatZZ 
,ZZ  
Carbohydrate[[ 
=[[ 
model[[ $
.[[$ %
Carbohydrate[[% 1
,[[1 2
Protein\\ 
=\\ 
model\\ 
.\\  
Protein\\  '
,\\' (
KCal]] 
=]] 
model]] 
.]] 
	TotalKcal]] &
,]]& '
UserId^^ 
=^^ 
userId^^ 
}__ 
;__ 
_repoaa 
.aa 
Updateaa 
(aa 
entryaa 
)aa 
;aa  
returnbb 
	NoContentbb 
(bb 
)bb 
;bb 
}cc 	
}dd 
}ee ˜
DD:\macrotracker\MacroTracker\MacroTracker.DietaryData\Domain\Food.cs
	namespace 	
MacroTracker
 
. 
DietaryData "
." #
Domain# )
{ 
public 

class 
Food 
{ 
public		 
static		 
double		 
Protein		 $
=>		% '
$num		( )
;		) *
public

 
static

 
double

 
Fat

  
=>

! #
$num

$ %
;

% &
public 
static 
double 
Carbohydrate )
=>* ,
$num- .
;. /
private 
double 
_kcal 
; 
	protected 
Food 
( 
) 
{ 	
} 	
public 
Food 
( 
string 
name 
,  
double! '
kcal( ,
), -
{ 	
if 
( 
kcal 
<= 
$num 
) 
throw 
new '
ArgumentOutOfRangeException 5
(5 6
$str6 <
)< =
;= >
_kcal 
= 
kcal 
; 
Name 
= 
name 
; 
} 	
public 
Food 
( 
string 
name 
)  
=>! #
Name$ (
=) *
name+ /
;/ 0
public!! 
Food!! 
(!! 
double!! 
kcal!! 
)!!  
{"" 	
if## 
(## 
kcal## 
<=## 
$num## 
)## 
throw$$ 
new$$ '
ArgumentOutOfRangeException$$ 5
($$5 6
$str$$6 <
)$$< =
;$$= >
_kcal%% 
=%% 
kcal%% 
;%% 
}&& 	
public,, 
string,, 
Name,, 
{,, 
get,,  
;,,  !
set,," %
;,,% &
},,' (
public.. 
double.. 
Kcal.. 
{// 	
get00 
=>00 
_kcal00 
;00 
set11 
{22 
if33 
(33 
value33 
<=33 
$num33 
)33 
throw44 
new44 
ArgumentException44 /
(44/ 0
$str440 L
)44L M
;44M N
_kcal55 
=55 
value55 
;55 
}66 
}77 	
}:: 
};; ú
ID:\macrotracker\MacroTracker\MacroTracker.DietaryData\Models\FoodEntry.cs
	namespace 	
MacroTracker
 
. 
DietaryData "
." #
Models# )
{ 
public		 

class		 
	FoodEntry		 
{

 
[ 	
BsonElement	 
] 
public 
DateTime 
	AddedDate !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
BsonElement	 
] 
[ 	
Range	 
( 
$num 
, 
$num 
) 
] 
public 
double 
Protein 
{ 
get  #
;# $
set% (
;( )
}* +
[ 	
BsonElement	 
] 
[ 	
Range	 
( 
$num 
, 
$num 
) 
] 
public 
double 
Fat 
{ 
get 
;  
set! $
;$ %
}& '
[ 	
BindRequired	 
] 
[ 	
Range	 
( 
$num 
, 
$num 
) 
] 
public 
double 
Carbohydrate "
{# $
get% (
;( )
set* -
;- .
}/ 0
[ 	
Required	 
] 
[ 	
Range	 
( 
$num 
, 
$num 
) 
] 
public 
double 
KCal 
{ 
get  
;  !
set" %
;% &
}' (
[ 	
BsonElement	 
] 
[ 	
Required	 
] 
public   
string   
UserId   
{   
get   "
;  " #
set  $ '
;  ' (
}  ) *
public"" 
ObjectId"" 
Id"" 
{"" 
get""  
;""  !
set""" %
;""% &
}""' (
}## 
}$$ ‹
RD:\macrotracker\MacroTracker\MacroTracker.DietaryData\Models\MacronutrientModel.cs
	namespace 	
MacroTracker
 
. 
DietaryData "
." #
Models# )
{ 
public 

class 
MacronutrientModel #
{ 
[ 	
Range	 
( 
$num 
, 
$num 
) 
] 
public		 
double		 
Protein		 
{		 
get		  #
;		# $
set		% (
;		( )
}		* +
[ 	
Range	 
( 
$num 
, 
$num 
) 
] 
public 
double 
Fat 
{ 
get 
;  
set! $
;$ %
}& '
[ 	
Range	 
( 
$num 
, 
$num 
) 
] 
public 
double 
Carbohydrate "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
double 
	TotalKcal 
=>  "
( 
Protein 
* 
Food 
. 
Protein #
)# $
+% &
(' (
Carbohydrate( 4
*5 6
Food7 ;
.; <
Carbohydrate< H
)H I
+J K
(L M
FatM P
*Q R
FoodS W
.W X
FatX [
)[ \
;\ ]
} 
} ¿
RD:\macrotracker\MacroTracker\MacroTracker.DietaryData\Models\UserTrainerRequest.cs
	namespace 	
MacroTracker
 
. 
DietaryData "
." #
Models# )
{ 
public 

class 
UserTrainerRequest #
{ 
public 
string 
UserId 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
	TrainerId 
{  !
get" %
;% &
set' *
;* +
}, -
public		 
DateTime		 
DateCreated		 #
{		$ %
get		& )
;		) *
set		+ .
;		. /
}		0 1
public

 
bool

 
IsActive

 
{

 
get

 "
;

" #
set

$ '
;

' (
}

) *
} 
} È
@D:\macrotracker\MacroTracker\MacroTracker.DietaryData\Program.cs
	namespace 	
MacroTracker
 
. 
DietaryData "
{ 
public 

static 
class 
Program 
{ 
public		 
static		 
void		 
Main		 
(		  
string		  &
[		& '
]		' (
args		) -
)		- .
=>		/ 1 
CreateWebHostBuilder		2 F
(		F G
args		G K
)		K L
.		L M
Build		M R
(		R S
)		S T
.		T U
Run		U X
(		X Y
)		Y Z
;		Z [
public 
static 
IWebHostBuilder % 
CreateWebHostBuilder& :
(: ;
string; A
[A B
]B C
argsD H
)H I
{ 	
var 
assemblyName 
= 
typeof %
(% &
StartupDevelopment& 8
)8 9
.9 :
GetTypeInfo: E
(E F
)F G
.G H
AssemblyH P
.P Q
FullNameQ Y
;Y Z
return 
WebHost 
.  
CreateDefaultBuilder /
(/ 0
args0 4
)4 5
. 

UseStartup 
( 
assemblyName (
)( )
;) *
} 	
} 
} ¡
QD:\macrotracker\MacroTracker\MacroTracker.DietaryData\Queries\DietaryDataQuery.cs
	namespace 	
MacroTracker
 
. 
DietaryData "
." #
Queries# *
{ 
public 

class 
DietaryDataQuery !
{		 
public

 
string

 
UserId

 
{

 
get

 "
;

" #
set

$ '
;

' (
}

) *
public 
DateTime 
	StartDate !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
DateTime 
EndDate 
{  !
get" %
;% &
set' *
;* +
}, -
} 
} á
\D:\macrotracker\MacroTracker\MacroTracker.DietaryData\Repository\FoodEntryMongoRepository.cs
	namespace

 	
MacroTracker


 
.

 
DietaryData

 "
.

" #

Repository

# -
{ 
public 

class $
FoodEntryMongoRepository )
:* +#
AbstractMongoRepository, C
<C D
	FoodEntryD M
>M N
,N O 
IFoodEntryRepositoryP d
{ 
public $
FoodEntryMongoRepository '
(' (
IConfiguration( 6
config7 =
)= >
:? @
baseA E
(E F
configF L
)L M
{ 	
} 	
	protected 
override 
string !
CollectionName" 0
=>1 3
$str4 D
;D E
public 
void 
Delete 
( 
string !
objectId" *
)* +
=>, .
MongoCollection/ >
.> ?
	DeleteOne? H
(H I
xI J
=>K M
xN O
.O P
IdP R
==S U
ObjectIdV ^
.^ _
Parse_ d
(d e
objectIde m
)m n
)n o
;o p
public 
IEnumerable 
< 
	FoodEntry $
>$ %
Get& )
() *

Expression* 4
<4 5
Func5 9
<9 :
	FoodEntry: C
,C D
boolE I
>I J
>J K
	predicateL U
)U V
=>W Y
MongoCollection 
. 
Find 
( 
	predicate 
) 
. 
ToList 
( 
) 
; 
public 
void 
Insert 
( 
	FoodEntry $
entity% +
)+ ,
=>- /
MongoCollection0 ?
.? @
	InsertOne@ I
(I J
entityJ P
)P Q
;Q R
public 
void 
Update 
( 
	FoodEntry $
entity% +
)+ ,
=>- /
MongoCollection0 ?
.? @

ReplaceOne@ J
(J K
eK L
=>M O
eP Q
.Q R
IdR T
==U W
entityX ^
.^ _
Id_ a
,a b
entityc i
)i j
;j k
public 
	FoodEntry 
Find 
( 
string $
userId% +
,+ ,
string- 3
entryId4 ;
); <
=>= ?
MongoCollection   
.!! 
Find!! 
(!! 
e!! 
=>!! 
e!! 
.!! 
Id!! 
==!! 
ObjectId!! '
.!!' (
Parse!!( -
(!!- .
entryId!!. 5
)!!5 6
&&!!7 9
e!!: ;
.!!; <
UserId!!< B
==!!C E
userId!!F L
)!!L M
."" 
FirstOrDefault"" 
("" 
)"" 
;"" 
}## 
}$$ ð
XD:\macrotracker\MacroTracker\MacroTracker.DietaryData\Repository\IFoodEntryRepository.cs
	namespace 	
MacroTracker
 
. 
DietaryData "
." #

Repository# -
{ 
public 

	interface  
IFoodEntryRepository )
:* +
IRepository, 7
<7 8
	FoodEntry8 A
>A B
{ 
	FoodEntry 
Find 
( 
string 
userId $
,$ %
string& ,
entryId- 4
)4 5
;5 6
} 
}		 °
OD:\macrotracker\MacroTracker\MacroTracker.DietaryData\Repository\IRepository.cs
	namespace 	
MacroTracker
 
. 
DietaryData "
." #

Repository# -
{ 
public 

	interface 
IRepository  
<  !
TEntity! (
>( )
{ 
void		 
Insert		 
(		 
TEntity		 
entity		 "
)		" #
;		# $
void 
Update 
( 
TEntity 
entity "
)" #
;# $
void 
Delete 
( 
string 
objectId #
)# $
;$ %
IEnumerable 
< 
TEntity 
> 
Get  
(  !

Expression! +
<+ ,
Func, 0
<0 1
TEntity1 8
,8 9
bool: >
>> ?
>? @
	predicateA J
)J K
;K L
} 
} ¿
]D:\macrotracker\MacroTracker\MacroTracker.DietaryData\Repository\MongoDbAbstractRepository.cs
	namespace 	
MacroTracker
 
. 
DietaryData "
." #

Repository# -
{ 
public 

abstract 
class #
AbstractMongoRepository 1
<1 2
T2 3
>3 4
{ 
	protected 
IMongoCollection "
<" #
T# $
>$ %
MongoCollection& 5
{6 7
get8 ;
;; <
}= >
	protected

 #
AbstractMongoRepository

 )
(

) *
IConfiguration

* 8
config

9 ?
)

? @
{ 	
var 
client 
= 
new 
MongoClient (
(( )
config) /
./ 0
GetConnectionString0 C
(C D
$strD M
)M N
)N O
;O P
var 
database 
= 
client !
.! "
GetDatabase" -
(- .
config. 4
.4 5

GetSection5 ?
(? @
$str@ G
)G H
[H I
$strI Q
]Q R
)R S
;S T
MongoCollection 
= 
database &
.& '
GetCollection' 4
<4 5
T5 6
>6 7
(7 8
CollectionName8 F
)F G
;G H
} 	
	protected 
abstract 
string !
CollectionName" 0
{1 2
get3 6
;6 7
}8 9
} 
} ¢
KD:\macrotracker\MacroTracker\MacroTracker.DietaryData\StartupDevelopment.cs
	namespace		 	
MacroTracker		
 
.		 
DietaryData		 "
{

 
public 

class 
StartupDevelopment #
{ 
public 
StartupDevelopment !
(! "
IConfiguration" 0
configuration1 >
)> ?
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public 
void 
ConfigureServices %
(% &
IServiceCollection& 8
services9 A
)A B
{ 	
services 
. 
AddMvc 
( 
) 
. #
SetCompatibilityVersion 5
(5 6 
CompatibilityVersion6 J
.J K
Version_2_2K V
)V W
;W X
services 
. 
AddTransient !
<! " 
IFoodEntryRepository" 6
,6 7$
FoodEntryMongoRepository8 P
>P Q
(Q R
)R S
;S T
services 
. 
AddSwaggerGen "
(" #
c# $
=>% '
c( )
.) *

SwaggerDoc* 4
(4 5
$str5 9
,9 :
new; >
Swashbuckle? J
.J K

AspNetCoreK U
.U V
SwaggerV ]
.] ^
Info^ b
{c d
Titlee j
=k l
$strm {
,{ |
Version	} „
=
… †
$str
‡ ‹
}
Œ 
)
 Ž
)
Ž 
;
 
} 	
public 
void 
	Configure 
( 
IApplicationBuilder 1
app2 5
,5 6
IHostingEnvironment7 J
envK N
)N O
{ 	
app 
. %
UseDeveloperExceptionPage )
() *
)* +
;+ ,
app   
.   

UseSwagger   
(   
)   
;   
app!! 
.!! 
UseSwaggerUI!! 
(!! 
c!! 
=>!! !
c!!" #
.!!# $
SwaggerEndpoint!!$ 3
(!!3 4
$str!!4 N
,!!N O
$str!!P a
)!!a b
)!!b c
;!!c d
app## 
.## 
UseHttpsRedirection## #
(### $
)##$ %
;##% &
app$$ 
.$$ 
UseMvc$$ 
($$ 
)$$ 
;$$ 
}%% 	
}&& 
}'' Û
JD:\macrotracker\MacroTracker\MacroTracker.DietaryData\StartupProduction.cs
	namespace 	
MacroTracker
 
. 
DietaryData "
{		 
public

 

class

 
StartupProduction

 "
{ 
public 
StartupProduction  
(  !
IConfiguration! /
configuration0 =
)= >
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public 
void 
ConfigureServices %
(% &
IServiceCollection& 8
services9 A
)A B
{ 	
services 
. 
AddMvc 
( 
) 
. #
SetCompatibilityVersion 5
(5 6 
CompatibilityVersion6 J
.J K
Version_2_2K V
)V W
;W X
Console 
. 
	WriteLine 
( 
Configuration +
.+ ,

GetSection, 6
(6 7
$str7 A
)A B
.B C
GetValueC K
<K L
stringL R
>R S
(S T
$strT ^
)^ _
)_ `
;` a
} 	
public 
void 
	Configure 
( 
IApplicationBuilder 1
app2 5
,5 6
IHostingEnvironment7 J
envK N
)N O
{ 	
app 
. 
UseHsts 
( 
) 
; 
app 
. 
UseHttpsRedirection #
(# $
)$ %
;% &
app 
. 
UseMvc 
( 
) 
; 
}   	
}!! 
}"" 